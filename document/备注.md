#### 基础环境 ####
1. Spring Boot
    版本：2.7.6
    java版本：11

2. Docker(MySql)
    镜像：mysql:8.0.31
    获取CMD：docker pull mysql:8.0.31

3. Docker(Vault)
    镜像：vault:1.12.2
    获取CMD：docker pull vault:1.12.2


#### MySql关联 ####
1. 进入容器
    CMD：docker exec -it mysql-db-server bash

2. 执行SQL
    CMD：mysql -h192.168.3.137 -P3306 -utestuser -ptestpassword -Dtest_db</etc/mysql/init/init_db.sql
    说明： ** 参数与参数值之间不能有空格
      -h: DB服务器host
      -P: 端口
      -u: 用户名
      -p: 密码
      -D: DB
       <: sql文件路径

3. 从容器中取得SSL文件
    CMD：docker cp mysql-db-server:/var/lib/mysql ./mysql/ssl_file
    说明：
       mysql-db-server：需要拷贝的文件所在的容器
       /var/lib/mysql：容器中需要拷贝的目标文件夹
       ./mysql/ssl_file：文件拷贝后的存放目录
     ** 因为文件过多，直接获取整个文件夹
     ** 这些SSL文件均为Mysql创建时，自动生成的文件
     ** 各文件说明：
          ca.pem: 自签CA证书，客户端连接也需要提供
          ca-key.pem: CA私钥
          client-cert.pem: 客户端连接服务器端需要提供的证书文件
          client-key.pem: 客户端连接服务器端需要提供的私钥文件
          private_key.pem: 私钥/公钥对的私有成员
          public_key.pem: 私钥/公钥对的共有成员
          server-cert.pem: 服务器端证书文件
          server-key.pem: 服务器端私钥文件

4. MySql配置文件存放路径
    /etc/my.cnf
    /etc/mysql/my.cnf 

5. 生成密钥库（truststore）文件
    CMD：keytool -importcert -alias Cacert -file ./mysql/ssl_file/ca.pem  -keystore ./mysql/ssl_file/truststoremysql -storepass password
    说明：
     keystore：密钥库文件名称   
     storepass：密钥库密码

6. 生成keystore文件
    CMD：
      openssl pkcs12 -export -in ./mysql/ssl_file/client-cert.pem -inkey ./mysql/ssl_file/client-key.pem -name "mysqlclient" -passout pass:password -out ./mysql/ssl_file/client-keystore.p12
      keytool -importkeystore -srckeystore ./mysql/ssl_file/client-keystore.p12 -srcstoretype pkcs12 -srcstorepass password -destkeystore ./mysql/ssl_file/keystoremysql -deststoretype JKS -deststorepass password

7. 连接到MySql
    CMD：mysql -uroot -ppassword

8. 查看SSL状态(DB内命令)
    CMD：
      status;
      use mysql;
      select ssl_type from user where user='testuser' and host='%';
      show variables like '%ssl%';

9. 创建SSL登录用账号(DB内命令)
    CREATE USER 'xxx'@'172.22.0.1' IDENTIFIED BY 'password' REQUIRE SSL;
    GRANT ALL ON test_db.* TO 'xxx'@'172.22.0.1';


#### Spring Boot关联 ####
1. spring.datasource.url说明
  1.1 参数说明：
       verifyServerCertificate：是否验证SSL证书信息。设定值为false时，账户名，密码验证通过，即可连接到MySql。
                               也就是说，此时在请求URL中不指定SSL证书的KeyStore和TrustStore也是可以连接到MySql的
       useSSL：是否启用SSL验证。如果Mysql需要SSL验证，但Spring Boot未设置为true；此时，即使账户名，密码验证通过也无法连接到MySql。
  1.2 具体连接可用状况
      ** (在账户名，密码验证通过，且提供的证书情报「KeyStore/TrustStore」验证通过的情况下)
      ** 下记false，包含设定值为false和为设定该字段两种情况
    a MySql: SSL验证要；useSSL: false
        -> 连接失败
    b MySql: SSL验证要；useSSL: true；verifyServerCertificate: false
        -> 连接成功
    c MySql: SSL验证要；useSSL: true；verifyServerCertificate: true；KeyStore/TrustStore: 未提供
        -> 连接失败
    d MySql: SSL验证要；useSSL: true；verifyServerCertificate: true；KeyStore/TrustStore: 提供
        -> 连接成功

#### Vault关联 ####
1. 连接到Docker
    CMD：docker exec -it vault-server sh

2. Vault初期化
    CMD：vault operator init -key-shares=1 -key-threshold=1
    说明：
      key-shares: 指定秘钥的总股数
      key-threshold: 指定秘钥的总股数
      ** 上记两个参数可同时省略
    生成的Token和Key：
      Token：hvs.NEEMtRoZfH5TEjUkDCvpqPVr
      Key：6NaeMdSzgz9RP6Mo5zv/Eqzm7dIGPPK8TaC89C2a6Xg=



#### 其它 ####
1. 解决端口占用(mac)
 1.1 查看占用端口的程序
    CMD：lsof -i tcp:8200
 1.2 强制结束程序
    CMD：kill -9 2221


MySql
 1. SSL登录：
   在MySql启动配置SSL验证OK，在Spring Boot可以实现账号密码+SSL认证登录到MySql。但是单独使用SSL认证登录到Mysql还没实现。
 2. 从Vault取得密码登录：
   调查中。。。